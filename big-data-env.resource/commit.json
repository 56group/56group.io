{"compress":true,"commitItems":[["ebb1be96-ee2f-4f00-9db4-0d15a0c9d70a",1566313035435,"---\ntitle: 大数据环境安装\ndate: 2019-07-31 13:52:00\ntags: [大数据, INSTALL]\ncategories: 大数据\n---\n\n### 准备环境安装 (CentOS 7)\n\n##### 配置系统主机名\n\n```shell\nshell> vi /etc/sysconfig/network\nshell> vi /etc/hosts\nshell> vi /etc/hostname\n```\n\n##### hosts\n\n```\nIP_1 HOST_NAME_1.com.cn HOST_NAME_1\nIP_2 HOST_NAME_2.com.cn  HOST_NAME_2\nIP_3 HOST_NAME_3.com.cn HOST_NAME_3\nIP_4 HOST_NAME_4.com.cn HOST_NAME_4\n```\n\n##### network\n\n```\nNETWORKING=yes\nHOSTANAME=YOUR_HOST_NAME\n```\n\n##### 关闭防火墙\n\n```shell\nshell> systemctl status firewalld\nshell> systemctl disable firewalld\nshell> systemctl stop firewalld\n```\n\n#### 关闭SELINUX\n\n```shell\n# sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\nshell> vi /etc/selinux/config\n```\n\n##### config\n\n```\nSELINUX=disabled\n```\n\n##### 关闭THP\n\n```\n# sed -i 's/quiet/quiet transparent_hugepage=never/g' /etc/default/grub\nshell> vi /etc/default/grub\nshell> vi /etc/init.d/disable-transparent-hugepages\nshell> chmod 755 /etc/init.d/disable-transparent-hugepages\nshell> chkconfig --add disable-transparent-hugepages\nshell> grub2-mkconfig -o /boot/grub2/grub.cfg \nshell> systemctl disable tuned\n# [参考](https://blog.csdn.net/ffwar/article/details/77853498)\n```\n\n##### grub\n\n```\nGRUB_CMDLINE_LINUX=\"net.ifnames=0 spectre_v2=off nopti crashkernel=auto transparent_hugepage=never \"\n```\n\n##### disable-transparent-hugepages\n\n```\n#!/bin/bash\n### BEGIN INIT INFO\n# Provides:          disable-transparent-hugepages\n# Required-Start:    $local_fs\n# Required-Stop:\n# X-Start-Before:    mongod mongodb-mms-automation-agent\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: Disable Linux transparent huge pages\n# Description:       Disable Linux transparent huge pages, to improve\n#                    database performance.\n### END INIT INFO\n\ncase $1 in\n  start)\n    if [ -d /sys/kernel/mm/transparent_hugepage ]; then\n      thp_path=/sys/kernel/mm/transparent_hugepage\n    elif [ -d /sys/kernel/mm/redhat_transparent_hugepage ]; then\n      thp_path=/sys/kernel/mm/redhat_transparent_hugepage\n    else\n      return 0\n    fi\n\n    echo 'never' > ${thp_path}/enabled\n    echo 'never' > ${thp_path}/defrag\n\n    re='^[0-1]+$'\n    if [[ $(cat ${thp_path}/khugepaged/defrag) =~ $re ]]\n    then\n      # RHEL 7\n      echo 0  > ${thp_path}/khugepaged/defrag\n    else\n      # RHEL 6\n      echo 'no' > ${thp_path}/khugepaged/defrag\n    fi\n\n    unset re\n    unset thp_path\n    ;;\nesac\n```\n\n##### 关闭PackageKit(如果存在)\n\n```shell\n# 禁止离线更新\nshell> systemctl disable packagekit\nshell> systemctl  stop  packagekit\nshell> yum remove PackageKit\nshell> systemctl  status packagekit\n```\n\n##### 同步时钟(所有机器同步到一个机器上)\n\n```shell\n# 单独机器同步时钟方案\n# shell> crontab -e\n# 0 1 * * * /usr/sbin/ntpdate cn.pool.ntp.org\n\n# 集群同步时钟方案\nshell> vi /etc/ntp.conf\nshell> systemctl restart ntpd\nshell> chkconfig ntpd on\nshell> ntpstat\nshell> ntpq -p\n\n# [参考]([https://www.cnblogs.com/quchunhui/p/7658853.html](https://www.cnblogs.com/quchunhui/p/7658853.html))\n```\n\n##### Server的ntp.conf\n\n```\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\nserver 127.127.1.0 fudge\nfudge 127.127.1.0 stratum 0\n#server 0.rhel.pool.ntp.org iburst\n#server 1.rhel.pool.ntp.org iburst\n#server 2.rhel.pool.ntp.org iburst\n#server 3.rhel.pool.ntp.org iburst\n```\n\n##### Client的ntp.conf\n\n```\n# Hosts on local network are less restricted.\nrestrict YOUR_SERVER_IP mask YOUR_SERVER_MARK(255.255.255.0) nomodify notrap\t\n\n# Please consider joining the pool (http://www.pool.ntp.org/join.html).\nserver YOUR_SERVER_IP prefer\nfudge 127.127.1.0 stratum 3\n```\n\n##### 互信通信\n\n```shell\nshell> ssh-keygen # 3次回车,不要输入密码\nshell> cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\nshell> ssh-copy-id -i ~/.ssh/id_rsa.pub root@YOUR_IP\n```\n\n##### 安装JDK环境(JDK 1.7+)\n\n```shell\nshell> tar zxvf jdk-8u221-linux-x64.tar.gz -C /usr/local/\nshell> ln -s /usr/local/jdk1.8.0_221/ /usr/local/jdk8\nshell> vi /etc/profile.d/env.sh\nshell> source /etc/profile.d/env.sh\nshell> javac\nshell> java -version\n```\n\n##### env.sh\n\n```bash\nexport JAVA_HOME=/usr/local/jdk8\nexport PATH=$JAVA_HOME/bin:$PATH\n```\n\n##### 启动httpd (只有Ambari机器安装httpd)\n\n```shell\nshell> yum -y install httpd\nshell> systemctl start httpd\nshell> chkconfig httpd on\n```\n\n##### 安装依赖库\n\n```shell\nshell> yum install libtirpc-devel* -y\nshell> yum -y install nfs*\n```\n\n##### 替换yum源\n\n```shell\nshell> cd /etc/yum.repos.d\nshell> mkdir bak\nshell> mv *.repo bak\n# 上传新的yum源\n```\n\n##### centos7.3.repo\n\n```\n[centos7.3]\nname=centos7.3\nbaseurl=http://10.1.240.11/centos7.3\nenabled=1\ngpgcheck=0\n```\n\n##### 配置数据库(ambari机器)\n\n```\nmysql> CREATE USER 'ambari'@'localhost' IDENTIFIED BY 'ambari!23';\nmysql> CREATE USER 'hive'@'localhost' IDENTIFIED BY 'hive!@3';\nmysql> GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'localhost' WITH GRANT OPTION;\nmysql> GRANT ALL PRIVILEGES ON *.* TO 'hive'@'localhost' WITH GRANT OPTION;\nmysql> exit\nshell> mysql -uambari -p\nmysql> CREATE SCHEMA `ambari` DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci;\nmysql> use ambari\nmysql> source Ambari-DDL-MySQL-CREATE.sql;\n```\n\n##### 上传mysql jar驱动\n\n```shell\nshell> mkdir /usr/share/java\nshell> mv mysql-connector-java-6.0.6.jar  /usr/share/java/\n```\n",[[1566313016757,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4221," "]],[4220,4220],[4221,4221]]],[1566313018139,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4221,"openssl"]],[4221,4221],[4228,4228]]],[1566313018803,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4229," "]],[4228,4228],[4229,4229]]],[1566313021129,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4229,"openssl-del"]],[4229,4229],[4240,4240]]],[1566313021933,["liunaidi@LiuNaidideMacBook-Pro.local",[[-1,4239,"l"]],[4240,4240],[4239,4239]]],[1566313022348,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4239,"vel"]],[4239,4239],[4242,4242]]],[1566313023046,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4243," "]],[4242,4242],[4243,4243]]],[1566313023568,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4243,"pt"]],[4243,4243],[4245,4245]]],[1566313024581,["liunaidi@LiuNaidideMacBook-Pro.local",[[-1,4244,"t"]],[4245,4245],[4244,4244]]],[1566313024721,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4244,"y"]],[4244,4244],[4245,4245]]],[1566313025201,["liunaidi@LiuNaidideMacBook-Pro.local",[[-1,4243,"py"]],[4245,4245],[4243,4243]]],[1566313025450,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4243,"p"]],[4243,4243],[4244,4244]]],[1566313025905,["liunaidi@LiuNaidideMacBook-Pro.local",[[-1,4243,"p"]],[4244,4244],[4243,4243]]],[1566313028216,["liunaidi@LiuNaidideMacBook-Pro.local",[[1,4243,"python-devel"]],[4243,4243],[4255,4255]]]],null,"liunaidi@LiuNaidideMacBook-Pro.local"]]}